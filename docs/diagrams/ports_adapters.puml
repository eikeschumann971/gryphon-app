@startuml
title Ports & Adapters (hexagonal) - gryphon-app
left to right direction
skinparam componentStyle rectangle

package "Application" {
  [PathPlanningService] <<component>>
  [LogicalAgentService] <<component>>
}

package "Domain (Ports)" {
  interface "GraphStoreAsync" as GraphStorePort
  interface "PathPlanningDataSource" as DataSourcePort
  interface "EventStore" as EventStorePort
  interface "DomainLogger (DynLogger)" as LoggerPort
}

package "Outbound Adapters" {
  component "FilesystemDataSource" as FS <<adapter>>
  component "PostgresGraphStore" as PG <<adapter>>
  component "KafkaAdapter" as KAFKA <<adapter>>
    component "ESRS PgStore Adapter" as ESRS <<adapter>>
  component "FileLogger" as FILELOG <<adapter>>
  component "ConsoleLogger" as CONSLOG <<adapter>>
}

package "Infrastructure" {
  database "Postgres" as DB
  [Kafka Cluster]
  folder "resources/path_planning" as ASSETS
}

PathPlanningService ..> GraphStorePort : depends on
PathPlanningService ..> DataSourcePort : depends on
PathPlanningService ..> EventStorePort : emits events to
PathPlanningService ..> LoggerPort : logs domain events to

FS ..|> DataSourcePort
PG ..|> GraphStorePort
KAFKA ..|> EventStorePort
ESRS ..|> EventStorePort
FILELOG ..|> LoggerPort
CONSLOG ..|> LoggerPort

PG --> DB : stores graph bytes
FS --> ASSETS : reads/writes graphs
KAFKA --> [Kafka Cluster]
ESRS --> DB : mirror store (best-effort)

note right of PathPlanningService
  - Implements orchestration of path planning
  - Uses command actors / aggregates
  - Events are published to Kafka; ESRS PgStore mirrors events into Postgres for queries
end note

@enduml
